appId: com.aionui.app
productName: AionUi
copyright: Copyright © 2024 AionUi

# Note: Main entry point is defined in package.json

# ASAR configuration for production
asar:
  smartUnpack: true

directories:
  output: out
  buildResources: resources

files:
  - .webpack/**/*
  - public/**/*
  - package.json
  - '!**/node_modules/*/{CHANGELOG.md,README.md,README,readme.md,readme}'
  - '!**/node_modules/*/{test,__tests__,tests,powered-test,example,examples}'
  - '!**/node_modules/*.d.ts'
  - '!**/node_modules/.bin'
  - '!**/{.DS_Store,.git,.gitignore,.gitattributes}'
  - '!**/{__pycache__,thumbs.db,.flowconfig,.idea,.vs,.nyc_output}'
  - '!**/{appveyor.yml,.travis.yml,circle.yml}'
  - '!**/{npm-debug.log,yarn.lock,.yarn-metadata.json,yarn-error.log}'
  - '!**/node_modules/@img/**'
  - '!**/node_modules/@img/sharp-*/**'
  - '!**/node_modules/@emnapi/**'

extraResources:
  - from: public
    to: .

# Windows configuration
win:
  target:
    - target: nsis
      arch: [x64, arm64]
    - target: msi
      arch: [x64, arm64]
    - target: zip
      arch: [x64, arm64]
  # icon: resources/app.ico  # Temporarily disabled - current ico is 32x32, need 256x256+
  artifactName: ${productName}-${version}-${os}-${arch}.${ext}

# NSIS installer configuration
nsis:
  oneClick: false
  allowToChangeInstallationDirectory: true
  createDesktopShortcut: true
  createStartMenuShortcut: true
  shortcutName: ${productName}
  uninstallDisplayName: ${productName}

# macOS configuration
mac:
  target:
    - target: dmg
      arch: [x64, arm64]
    - target: zip
      arch: [x64, arm64]
  icon: resources/app.icns
  artifactName: ${productName}-${version}-${os}-${arch}.${ext}
  category: public.app-category.productivity
  # 动态签名配置，参考 forge.config.ts 的逻辑
  # identity 从环境变量获取，不在配置文件中设置
  hardenedRuntime: true
  gatekeeperAssess: false
  entitlements: entitlements.plist
  entitlementsInherit: entitlements.plist
  # identity 通过环境变量控制，notarize 通过 afterSign 脚本处理

# Code signing and notarization
afterSign: scripts/afterSign.js

# Linux configuration
linux:
  target:
    - target: deb
      arch: [x64, arm64]
    - target: AppImage
      arch: [x64, arm64]
  icon: resources/app
  artifactName: ${productName}-${version}-${os}-${arch}.${ext}
  category: Utility
  maintainer: aionui
  vendor: aionui
  synopsis: ${description}
  description: ${description}
  # 确保 desktop 文件包含图标信息
  desktop:
    Name: AionUi
    Comment: ${description}
    Icon: aionui
    Categories: Office;Utility;

# Native dependency handling - skip rebuilds in CI to avoid compilation issues
npmRebuild: false
buildDependenciesFromSource: false

# ASAR configuration for production
asarUnpack:
  - "**/node_modules/node-pty/**/*"

# CI/CD optimizations
compression: normal
removePackageScripts: true

# Publish configuration for CI/CD (only for tagged releases)
publish:
  provider: github
  owner: ${env.GITHUB_REPOSITORY_OWNER:-aionui}
  repo: ${env.GITHUB_REPOSITORY_NAME:-AionUi}
  # Only publish when GH_TOKEN is available (tagged releases)
  publishAutoUpdate: false
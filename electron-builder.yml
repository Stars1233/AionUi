appId: com.aionui.app
productName: AionUi
copyright: Copyright © 2024 AionUi

# Note: Main entry point is defined in package.json

# ASAR configuration for production
asar:
  smartUnpack: true

directories:
  output: out
  buildResources: resources

files:
  - .webpack/main/**/*  # 只包含 main 目录（桌面模式需要）
  - .webpack/renderer/**/*  # 包含 renderer 目录（桌面模式需要）
  - public/**/*
  - package.json
  # 排除开发和测试文件
  - '!**/node_modules/*/{CHANGELOG.md,README.md,README,readme.md,readme}'
  - '!**/node_modules/*/{test,__tests__,tests,powered-test,example,examples}'
  - '!**/node_modules/*/{*.test.js,*.spec.js,*.test.ts,*.spec.ts}'
  - '!**/node_modules/*.d.ts'
  - '!**/node_modules/.bin'
  - '!**/node_modules/*/{docs,documentation,doc}'
  # 排除系统文件
  - '!**/{.DS_Store,.git,.gitignore,.gitattributes}'
  - '!**/{__pycache__,thumbs.db,.flowconfig,.idea,.vs,.nyc_output}'
  - '!**/{appveyor.yml,.travis.yml,circle.yml}'
  - '!**/{npm-debug.log,yarn.lock,.yarn-metadata.json,yarn-error.log}'
  # 排除大型第三方包的非必需部分
  - '!**/node_modules/@img/**'
  - '!**/node_modules/@img/sharp-*/**'
  - '!**/node_modules/@emnapi/**'
  - '!**/node_modules/@anthropic-ai/claude-code/vendor/**'
  # 排除 Webpack 相关的 source maps 和开发文件
  - '!**/*.map'
  - '!**/.webpack/**/*.map'
  - '!**/webpack-stats.json'
  # 排除大量的语法高亮语言包 (仅保留常用语言)
  - '!**/.webpack/**/react-syntax-highlighter_languages_highlight_*'
  - '.webpack/**/react-syntax-highlighter_languages_highlight_{javascript,typescript,python,java,cpp,c,html,css,json,xml,yaml,shell,bash,dockerfile,sql,markdown,go,rust,php}'

extraResources:
  - from: public
    to: .
  - from: .webpack/${arch}/renderer
    to: .webpack/renderer
    filter:
      - '**/*'
      - '!**/*.map'
  - from: .webpack/${arch}/native_modules
    to: .webpack/native_modules
    filter:
      - '**/*'

# Windows configuration
win:
  target:
    - target: nsis
      arch: [ x64, arm64 ]
    #    - target: msi
    #      arch: [x64, arm64]
    - target: zip
      arch: [ x64, arm64 ]
  # icon: resources/app.ico  # Temporarily disabled - current ico is 32x32, need 256x256+
  artifactName: ${productName}-${version}-${os}-${arch}.${ext}

# NSIS installer configuration
nsis:
  oneClick: false
  allowToChangeInstallationDirectory: true
  createDesktopShortcut: true
  createStartMenuShortcut: true
  shortcutName: ${productName}
  uninstallDisplayName: ${productName}

# macOS configuration
mac:
  target:
    - target: dmg
      arch: [ x64, arm64 ]
    - target: zip
      arch: [ x64, arm64 ]
  icon: resources/app.icns
  artifactName: ${productName}-${version}-${os}-${arch}.${ext}
  category: public.app-category.productivity
  # 动态签名配置，参考 forge.config.ts 的逻辑
  # identity 从环境变量获取，不在配置文件中设置
  hardenedRuntime: true
  gatekeeperAssess: false
  entitlements: entitlements.plist
  entitlementsInherit: entitlements.plist
  # identity 通过环境变量控制，notarize 通过 afterSign 脚本处理

# Code signing and notarization
afterPack: scripts/afterPack.js
afterSign: scripts/afterSign.js

# Linux configuration
linux:
  target:
    - target: deb
      arch: [ x64, arm64, armv7l ]
    - target: AppImage
      arch: [ x64, arm64, armv7l ]
  icon: resources/app.png
  artifactName: ${productName}-${version}-${os}-${arch}.${ext}
  category: Utility
  maintainer: aionui
  vendor: aionui
  synopsis: ${description}
  description: ${description}
  # Desktop entry configuration
  desktop:
    entry:
      Name: AionUi
      Comment: ${description}
      Icon: aionui
      Categories: Office;Utility;

# Native dependency handling
# Enable per-architecture native module compilation for cross-platform builds
npmRebuild: true
buildDependenciesFromSource: true
# 减小包体积配置
nodeGypRebuild: false

# ASAR configuration for production - unpack native modules
asarUnpack:
  - "**/node_modules/{node-pty,bcrypt,better-sqlite3}/**/*"
  - "!**/node_modules/@anthropic-ai/claude-code/vendor/**/*"

# CI/CD optimizations  
compression: maximum
removePackageScripts: true
electronDownload:
  cache: ${env.ELECTRON_CACHE}

# Publish configuration for CI/CD (only for tagged releases)
publish:
  provider: github
  owner: ${env.GITHUB_REPOSITORY_OWNER:-aionui}
  repo: ${env.GITHUB_REPOSITORY_NAME:-AionUi}
  # Only publish when GH_TOKEN is available (tagged releases)
  publishAutoUpdate: false
